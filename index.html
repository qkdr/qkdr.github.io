<!doctype html>
<html lang="ar">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù…Ø­Ø±Ø± ÙˆØ­ÙØ¸ Ù…Ø¨Ø§Ø´Ø± (Ù…Ø¶Ù…Ù‘Ù† ØªÙˆÙƒÙ† Ø«Ø§Ø¨Øª)</title>
<style>
  :root{--bg:#f4f7fb;--card:#fff;--muted:#666}
  body{font-family:system-ui,Arial;direction:rtl;background:var(--bg);margin:0;padding:18px}
  .wrap{max-width:980px;margin:0 auto}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 8px 24px rgba(10,10,20,0.06);margin-top:12px}
  h1{margin:0 0 8px;font-size:20px}
  label{display:block;margin-top:10px;font-weight:600}
  input[type=text], textarea {width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;font-family:inherit}
  textarea{height:360px;font-family:monospace;font-size:13px;white-space:pre;overflow:auto}
  .row{display:flex;gap:8px;align-items:center}
  button{padding:8px 12px;border-radius:8px;border:0;background:#0b76ef;color:#fff;cursor:pointer}
  button.ghost{background:#6b7280}
  pre#log{height:140px;overflow:auto;background:#f3f6fb;padding:8px;border-radius:8px;border:1px solid #eef2f7}
  .note{color:var(--muted);font-size:13px;margin-top:8px}
  .danger{color:#b91c1c}
  .muted{color:#6b7280;font-size:13px}
  @media (max-width:720px){ .row{flex-direction:column;align-items:stretch} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Ù…Ø­Ø±Ø± Ø¨Ø³ÙŠØ· â€” ÙØªØ­ØŒ ØªØ¹Ø¯ÙŠÙ„ØŒ Ø­ÙØ¸ (ØªÙˆÙƒÙ† Ù…Ø¶Ù…Ù‘Ù†)</h1>
      <p class="note">Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ­ØªÙˆÙŠ ØªÙˆÙƒÙ† Ø«Ø§Ø¨Øª ØªÙ… ØªØ¶Ù…ÙŠÙ†Ù‡ ÙÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨Øª â€” Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø¨Ø¹Ù†Ø§ÙŠØ©. Ø¥Ø°Ø§ Ø§Ù†ÙƒØ´Ù Ø§Ù„ØªÙˆÙƒÙ†ØŒ Ø§Ø°Ù‡Ø¨ Ù„Ø­Ø³Ø§Ø¨ GitHub ÙˆØ§ØºÙÙ„Ù‚Ù‡ ÙÙˆØ±Ù‹Ø§.</p>

      <!-- ====== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Ø¹Ø¯Ù„ Ø¥Ø°Ø§ ØªØ±ÙŠØ¯) ====== -->
      <label>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ… Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¥Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆØ¯Ø¹ Ø¢Ø®Ø±)</label>
      <div class="row" style="gap:10px">
        <input id="owner" type="text" value="qkdr" placeholder="Owner (Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹)"/>
        <input id="repo" type="text" value="Lord" placeholder="Repo (Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹)"/>
        <input id="path" type="text" value="Lord.lua" placeholder="Path (Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù)"/>
        <input id="branch" type="text" value="main" placeholder="Branch"/>
      </div>

      <label>Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙƒÙ† (Ø«Ø§Ø¨Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª)</label>
      <div class="row" style="align-items:center">
        <div class="muted" id="tokenMask">ØªÙˆÙƒÙ† Ù…Ø¶Ù…Ù‘Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù (Ù…Ø®ÙÙŠ Ù‡Ù†Ø§)</div>
        <button id="revealBtn" class="ghost" title="Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†">Ø¹Ø±Ø¶</button>
        <button id="revokeHintBtn" class="ghost" title="Ù†ØµØ§Ø¦Ø­ Ù„Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙˆÙƒÙ†">ØªØ¹Ù„ÙŠÙ…Ø§Øª</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="editBtn">ØªØ¹Ø¯ÙŠÙ„</button>
        <button id="saveBtn">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
        <button id="reloadBtn" class="ghost">Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù</button>
        <button id="downloadBtn" class="ghost">ØªÙ†Ø²ÙŠÙ„ .lua</button>
      </div>

      <label>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù</label>
      <textarea id="editor" disabled placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø¬Ù„Ø¨..."></textarea>

      <label>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« (ØªÙØµÙŠÙ„ÙŠ â€” Ø³ÙŠØ¹Ø±Ø¶ Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„ÙØ´Ù„ Ø¥Ù† ÙˆÙØ¬Ø¯Øª)</label>
      <pre id="log">Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¬Ø§Ø±Ù...</pre>

      <p class="note">Ø¢Ù„ÙŠØ© Ø§Ù„Ø­ÙØ¸: ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø³ÙƒØ±Ø¨Øª GitHub REST API Ù„Ø¥Ù†Ø´Ø§Ø¡/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù. ÙŠÙØªØ±Ø¶ Ø£Ù† Ø§Ù„ØªÙˆÙƒÙ† Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ© `repo` Ø£Ùˆ `public_repo` Ø­Ø³Ø¨ Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.</p>
      <p class="note danger">Ù…Ø±Ø© Ø£Ø®Ø±Ù‰: ØªØ¶Ù…ÙŠÙ† Ø§Ù„ØªÙˆÙƒÙ† ÙÙŠ Ù…Ù„Ù HTML Ø®Ø·Ø± Ø£Ù…Ù†ÙŠØ› Ø§Ø³ØªØ®Ø¯Ù…Ù‡ ÙÙ‚Ø· ÙÙŠ Ø¨ÙŠØ¦Ø© Ù…ØºÙ„Ù‚Ø© Ø£Ùˆ Ù„Ø­Ø¸Ø©.</p>
    </div>
  </div>

<script>
/* ========== Ù‡Ù†Ø§ Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ø«Ø§Ø¨Øª Ø§Ù„Ø°ÙŠ Ø·Ù„Ø¨ØªÙ‡ ========== */
/* Ø¶Ø¹ Ø§Ù„ØªÙˆÙƒÙ† ÙƒÙ…Ø§ Ù‡Ùˆ (Ø£Ù†Øª Ø·Ù„Ø¨ØªÙ‡ Ù…Ø¶Ù…Ù‘Ù†) */
const FIXED_TOKEN = "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";
/* ================================================== */

const editor = document.getElementById('editor');
const logEl = document.getElementById('log');
const ownerEl = document.getElementById('owner');
const repoEl  = document.getElementById('repo');
const pathEl  = document.getElementById('path');
const branchEl = document.getElementById('branch');
const editBtn = document.getElementById('editBtn');
const saveBtn = document.getElementById('saveBtn');
const reloadBtn = document.getElementById('reloadBtn');
const downloadBtn = document.getElementById('downloadBtn');
const revealBtn = document.getElementById('revealBtn');
const tokenMask = document.getElementById('tokenMask');
const revokeHintBtn = document.getElementById('revokeHintBtn');

let currentSha = null;
let isEditing = false;
let reveal = false;

/* ======== Helpers ======== */
function writeLog(...parts){
  const t = new Date().toLocaleString();
  const line = `[${t}] ${parts.join(' ')}`;
  logEl.textContent = line + "\n" + logEl.textContent;
  console.log(line);
}
function utf8_to_b64(str){ return btoa(unescape(encodeURIComponent(str||""))); }
function b64_to_utf8(b64){ try{ return decodeURIComponent(escape(atob(b64))); }catch(e){ return atob(b64); } }

function apiUrl(owner,repo,path){ return `https://api.github.com/repos/${encodeURIComponent(owner)}/${encodeURIComponent(repo)}/contents/${encodeURIComponent(path)}`; }

/* ======== Reveal token UI ======== */
tokenMask.textContent = "ğŸ”’ ØªÙˆÙƒÙ† Ù…Ø¶Ù…Ù‘Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª";
revealBtn.addEventListener('click', ()=>{
  reveal = !reveal;
  if(reveal){
    tokenMask.textContent = FIXED_TOKEN;
    revealBtn.textContent = "Ø¥Ø®ÙØ§Ø¡";
  } else {
    tokenMask.textContent = "ğŸ”’ ØªÙˆÙƒÙ† Ù…Ø¶Ù…Ù‘Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª";
    revealBtn.textContent = "Ø¹Ø±Ø¶";
  }
});
revokeHintBtn.addEventListener('click', ()=>{
  alert("Ø¥Ø°Ø§ Ø§Ù†ÙƒØ´Ù Ø§Ù„ØªÙˆÙƒÙ†: Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Revoke/Delete.\n\nØ£Ù†Ø´Ø¦ ØªÙˆÙƒÙ† Ø¬Ø¯ÙŠØ¯ ÙˆÙ…ÙÙ†Ø­ ÙÙ‚Ø· Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© (Ù…Ø«Ù„Ø§Ù‹ public_repo Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©).");
});

/* ======== Load file ======== */
async function loadFile(){
  const owner = ownerEl.value.trim(), repo = repoEl.value.trim(), path = pathEl.value.trim(), branch = branchEl.value.trim();
  if(!owner || !repo || !path){ alert('Ø¹Ø¨ÙŠ owner, repo, path'); return; }
  const url = apiUrl(owner,repo,path) + (branch ? `?ref=${encodeURIComponent(branch)}` : '');
  writeLog('Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ù…Ù†:', url);
  editor.disabled = true;
  try{
    const res = await fetch(url, { headers: { Accept: 'application/vnd.github.v3+json' }});
    if(res.status === 404){
      editor.value = "-- Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (404). ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù†Ø´Ø§Ø¡Ù‡ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø­ÙØ¸."; currentSha = null;
      writeLog('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø¹Ù„Ù‰ GitHub (404). Ø³ÙŠÙ†Ø´Ø£ Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸.');
      return;
    }
    if(!res.ok) throw new Error('HTTP ' + res.status + ' ' + await res.text());
    const j = await res.json();
    const content = j.content ? b64_to_utf8(j.content.replace(/\n/g,'')) : '';
    editor.value = content;
    currentSha = j.sha || null;
    writeLog('ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­. sha=', currentSha);
  }catch(err){
    editor.value = `-- Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù:\n-- ${err.message}\n`;
    writeLog('Ø®Ø·Ø£ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù:', err.message);
  } finally {
    editor.scrollTop = 0;
  }
}

/* ======== Edit toggle ======== */
editBtn.addEventListener('click', ()=>{
  isEditing = !isEditing;
  editor.disabled = !isEditing;
  editBtn.textContent = isEditing ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„' : 'ØªØ¹Ø¯ÙŠÙ„';
  if(isEditing) { editor.focus(); writeLog('ØªØ­Ø±ÙŠØ± Ù…ÙØ¹Ù„'); } else { writeLog('ØªØ­Ø±ÙŠØ± Ù…Ø¹Ø·Ù„'); }
});

/* ======== Download local file ======== */
downloadBtn.addEventListener('click', ()=>{
  const blob = new Blob([editor.value], { type: 'text/plain;charset=utf-8' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = (pathEl.value || 'file.lua').split('/').pop();
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(a.href);
  writeLog('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ù…Ø­Ù„ÙŠØ§Ù‹');
});

/* ======== Save with retries and detailed errors ======== */
async function saveToGitHub(maxAttempts = 3){
  const owner = ownerEl.value.trim(), repo = repoEl.value.trim(), path = pathEl.value.trim(), branch = branchEl.value.trim();
  if(!owner||!repo||!path){ alert('Ø¹Ø¨ÙŠ owner, repo, path'); return; }
  const url = apiUrl(owner,repo,path);
  const token = FIXED_TOKEN;
  if(!token){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆÙƒÙ† Ù…Ø¶Ù…Ù†!'); return; }

  const contentB64 = utf8_to_b64(editor.value);
  const bodyBase = { message: `Update ${path} via web editor`, content: contentB64, branch: branch };
  if(currentSha) bodyBase.sha = currentSha;

  let attempt = 0;
  while(attempt < maxAttempts){
    attempt++;
    writeLog(`Ø­Ø§ÙˆÙ„Ø© Ø­ÙØ¸ #${attempt}...`);
    try{
      const res = await fetch(url, {
        method: 'PUT',
        headers: {
          'Authorization': 'token ' + token,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(bodyBase)
      });

      const text = await res.text();
      // Ø­Ø§ÙˆÙ„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø±Ø¯ Ù„Ø¬ÙŠØ³ÙˆÙ† Ø¥Ù† Ø£Ù…ÙƒÙ† Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
      let parsed = null;
      try{ parsed = JSON.parse(text); } catch(e){ parsed = null; }

      if(res.status === 200 || res.status === 201){
        const commitSha = parsed && parsed.commit && parsed.commit.sha ? parsed.commit.sha : '(unknown)';
        currentSha = parsed && parsed.content && parsed.content.sha ? parsed.content.sha : currentSha;
        writeLog('Ù†Ø¬Ø­ Ø§Ù„Ø­ÙØ¸! commit sha:', commitSha);
        alert('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¥Ù„Ù‰ GitHub Ø¨Ù†Ø¬Ø§Ø­!');
        return { ok: true, status: res.status, response: parsed || text };
      }

      // Ø­Ø§Ù„Ø© ÙØ´Ù„ â€” Ø¹Ø±Ø¶ Ø£Ø³Ø¨Ø§Ø¨ Ù…ÙØµÙ„Ø©
      writeLog(`ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ â€” HTTP ${res.status}`);
      if(parsed) {
        writeLog('Ø±Ø¯ Ø§Ù„Ø®Ø§Ø¯Ù… (json):', JSON.stringify(parsed, null, 2));
      } else {
        writeLog('Ø±Ø¯ Ø§Ù„Ø®Ø§Ø¯Ù… (Ù†Øµ):', text);
      }

      // ØªØ­Ù„ÙŠÙ„ Ø£Ø³Ø¨Ø§Ø¨ Ø´Ø§Ø¦Ø¹Ø© ÙˆØ±ÙØ¶ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ù†Ø¯ Ø£Ø®Ø·Ø§Ø¡ 4xx (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ 429) Ù„Ø£Ù†Ù‘Ù‡Ø§ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ù…ÙŠÙ„
      if(res.status >= 400 && res.status < 500 && res.status !== 429){
        // Ø£Ø®Ø·Ø§Ø¡ 401,403,422 Ø¥Ù„Ø® Ù„Ù† ØªÙØ¹Ø§Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        if(res.status === 401) writeLog('Ø³Ø¨Ø¨ Ù…Ø­ØªÙ…Ù„: ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ§Ù„Ø­ (401 Unauthorized). ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ† ÙˆØµÙ„Ø§Ø­ÙŠØ§ØªÙ‡.');
        if(res.status === 403) writeLog('Ø³Ø¨Ø¨ Ù…Ø­ØªÙ…Ù„: ØªÙˆÙƒÙ† Ù„Ø§ ÙŠÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© ÙƒØ§ÙÙŠØ© Ø£Ùˆ rate limit Ø£Ùˆ ÙŠØªÙ… Ø­Ø¸Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (403).');
        if(res.status === 422) writeLog('Ø³Ø¨Ø¨ Ù…Ø­ØªÙ…Ù„: Ù„Ù… ÙŠØªØºÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ ÙŠÙˆØ¬Ø¯ conflict ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (422 Unprocessable Entity).');
        return { ok:false, status:res.status, response: parsed || text };
      }

      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø®Ø·Ø£ Ø®Ø§Ø¯Ù… (5xx) Ø£Ùˆ 429 (rate limit) â€” Ø³Ù†Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø­ØªÙ‰ maxAttempts
      if(res.status >= 500 || res.status === 429){
        const backoff = 500 * Math.pow(2, attempt-1); // 500ms, 1000ms, 2000ms...
        writeLog(`Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø¹Ø·Ù‰ ${res.status}. Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ ${backoff}ms`);
        await new Promise(r=>setTimeout(r, backoff));
        continue;
      }

      // Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø© â€” Ù„Ø§ Ù†Ø¬Ø±Ø¨ Ù…Ø²ÙŠØ¯Ø§Ù‹
      return { ok:false, status:res.status, response: parsed || text };

    }catch(err){
      // Ø®Ø·Ø£ Ø´Ø¨ÙƒØ© â€” Ù†Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
      writeLog('Ø®Ø·Ø£ Ø´Ø¨ÙƒØ© Ø£Ø«Ù†Ø§Ø¡ PUT:', err.message);
      if(attempt < maxAttempts){
        const wait = 600 * attempt;
        writeLog(`Ø§Ù†ØªØ¸Ø§Ø± ${wait}ms Ø«Ù… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©...`);
        await new Promise(r=>setTimeout(r, wait));
        continue;
      } else {
        writeLog('Ø§Ù†ØªÙ‡Øª Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø³Ø¨Ø¨ Ø®Ø·Ø£ Ø´Ø¨ÙƒØ©.');
        return { ok:false, error: err.message };
      }
    }
  }

  return { ok:false, error: 'ÙˆØµÙ„Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª' };
}

/* Ø²Ø± Ø§Ù„Ø­ÙØ¸ */
saveBtn.addEventListener('click', async ()=>{
  if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ GitHub Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù…Ø¶Ù…Ù‘Ù†ØŸ')) return;
  // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¤Ù‚ØªØ§
  saveBtn.disabled = true; editBtn.disabled = true; reloadBtn.disabled = true;
  writeLog('Ø¨Ø¯Ø£Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­ÙØ¸...');
  const result = await saveToGitHub(3);
  if(!result.ok){
    writeLog('Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙØ´Ù„Øª. ØªÙØ§ØµÙŠÙ„:', JSON.stringify(result, null, 2));
    alert('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ â€” Ø§ÙØªØ­ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„.');
  }
  // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  saveBtn.disabled = false; editBtn.disabled = false; reloadBtn.disabled = false;
});

/* Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø¨ */
reloadBtn.addEventListener('click', loadFile);

/* ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø£ÙˆÙ„ Ù…Ø±Ø© */
loadFile();

/* Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª */
</script>
</body>
</html>
