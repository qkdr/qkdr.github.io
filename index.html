<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø§ÙƒØ³Ø¨Ù„ÙˆÙŠØª Ø§Ù„Ø¹Ø±Ø¨</title>
  <style>
    :root {
      --bg-light: #ffffff;
      --text-light: #000000;
      --bg-dark: #121212;
      --text-dark: #ffffff;
      --card-bg-light: rgba(0,0,0,0.05);
      --card-bg-dark: rgba(255,255,255,0.1);
      --frame-light: rgba(0,0,0,0.1);
      --frame-dark: rgba(255,255,255,0.2);
    }
    body {
      margin: 0; padding: 0;
      font-family: 'Tajawal', sans-serif;
      transition: background 0.3s, color 0.3s;
    }
    body.light-theme {
      background: var(--bg-light);
      color: var(--text-light);
    }
    body.dark-theme {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    .topbar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 20px;
    }
    .toggle-btn {
      padding: 8px 16px; border: none; border-radius: 8px; cursor: pointer;
    }
    body.light-theme .toggle-btn { background: #333; color: #fff; }
    body.dark-theme .toggle-btn { background: #eee; color: #000; }
    .glass {
      background: var(--card-bg-light);
      padding: 20px; margin: 0 auto 20px; max-width: 900px;
      border-radius: 12px; transition: background 0.3s;
    }
    body.dark-theme .glass { background: var(--card-bg-dark); }
    h1 { text-align: center; }
    .controls { text-align: center; margin-bottom: 15px; }
    select, input[type="text"], .btn {
      padding: 8px 12px; border-radius: 8px; border: 1px solid #aaa;
      margin: 5px; font-size: 1em;
    }
    body.dark-theme select, body.dark-theme input[type="text"] {
      background: #222; color: #ddd; border-color: #555;
    }
    body.light-theme select, body.light-theme input[type="text"] {
      background: #fff; color: #000;
    }
    .btn {
      background: #007bff; color: #fff; border: none; cursor: pointer;
      transition: background .3s;
    }
    .btn:hover { background: #0056b3; }
    #results {
      display: flex; flex-wrap: wrap; justify-content: center;
    }
    .script-card {
      background: var(--card-bg-light);
      width: 240px; margin: 10px; border-radius: 8px;
      overflow: hidden; transition: transform .2s;
      position: relative;
    }
    body.dark-theme .script-card { background: var(--card-bg-dark); }
    .script-card:hover { transform: scale(1.03); }
    .script-card img {
      width: 100%; height: 140px; object-fit: cover;
      cursor: pointer;
    }
    .overlay-left, .overlay-right {
      position: absolute; top: 8px; padding: 4px 8px;
      background: rgba(0,0,0,0.5); color: #fff; border-radius: 4px;
      font-size: .8em;
    }
    .overlay-left { left: 8px; }
    .overlay-right { right: 8px; }
    .script-info { padding: 10px; text-align: center; }
    .script-info h3 {
      margin: 5px 0; font-size: 1em;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    #loadMore { display: block; margin: 20px auto; }
    /* DETAIL VIEW */
    #detailContent {
      display: none; padding: 20px; max-width: 900px; margin: 0 auto;
    }
    .frame {
      border: 1px solid var(--frame-light);
      padding: 10px; border-radius: 8px;
      margin-bottom: 15px;
      transition: border-color .3s, background .3s;
    }
    body.dark-theme .frame {
      border-color: var(--frame-dark);
      background: rgba(255,255,255,0.05);
    }
    .detail-header {
      display: flex; gap: 20px;
    }
    .detail-header .left,
    .detail-header .right {
      flex: 1;
    }
    .detail-header .left img {
      width: 100%; border-radius: 8px;
    }
    .detail-header .right h2 {
      margin: 0; font-size: 1.5em;
    }
    .detail-header .right p {
      margin: 5px 0;
    }
    #description, #codeBox {
      width: 100%;
    }
    #description {
      background: var(--card-bg-light);
      padding: 10px; border-radius: 6px;
    }
    body.dark-theme #description {
      background: var(--card-bg-dark);
    }
    #codeBox {
      font-family: monospace;
      background: var(--card-bg-light);
      padding: 10px; border-radius: 6px;
      white-space: pre-wrap; overflow-x: auto;
    }
    body.dark-theme #codeBox {
      background: var(--card-bg-dark);
    }
    #codeCopyBtn {
      margin-top: 10px;
    }
    #backBtn {
      margin-bottom: 20px;
    }
  </style>
</head>
<body class="light-theme">

  <div class="topbar">
    <h1>Ø§ÙƒØ³Ø¨Ù„ÙˆÙŠØª Ø§Ù„Ø¹Ø±Ø¨</h1>
    <button id="themeToggle" class="toggle-btn">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
  </div>

  <!-- MAIN VIEW -->
  <div id="mainContent">
    <div class="glass">
      <div class="controls">
        <input id="searchInput" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙƒØ±Ø¨Øªâ€¦">
        <button id="searchBtn" class="btn">Ø¨Ø­Ø«</button>
        <select id="modeSelect">
          <option value="fetch">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</option>
          <option value="free">Ù…Ø¬Ø§Ù†ÙŠØ©</option>
          <option value="unverified">ØºÙŠØ± Ù…Ø­Ù‚Ù‚Ø©</option>
          <option value="mostviewed">Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©</option>
          <option value="verified">Ù…Ø­Ù‚Ù‚Ø©</option>
        </select>
      </div>
      <div id="results"></div>
      <button id="loadMore" class="btn" style="display:none;">Ø§Ù„Ù…Ø²ÙŠØ¯</button>
    </div>
  </div>

  <!-- DETAIL VIEW -->
  <div id="detailContent">
    <button id="backBtn" class="btn">â—€ Ø±Ø¬ÙˆØ¹</button>
    <div class="frame detail-header">
      <div class="left">
        <img id="detailImage" src="" alt="ØµÙˆØ±Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©">
      </div>
      <div class="right">
        <h2 id="detailTitle"></h2>
        <p><strong>Ø§Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©:</strong> <span id="detailGame"></span></p>
        <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±:</strong> <span id="detailDate"></span></p>
      </div>
    </div>
    <div class="frame">
      <h3>ÙˆØµÙ Ø§Ù„Ø³ÙƒØ±Ø¨Øª</h3>
      <div id="description"></div>
    </div>
    <div class="frame">
      <h3>Ø§Ù„ÙƒÙˆØ¯</h3>
      <div id="codeBox"></div>
      <button id="codeCopyBtn" class="btn">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
    </div>
  </div>

  <script>
    // Theme toggle
    const bodyEl = document.body;
    document.getElementById('themeToggle').onclick = () => {
      if (bodyEl.classList.contains('light-theme')) {
        bodyEl.classList.replace('light-theme','dark-theme');
        event.target.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­';
      } else {
        bodyEl.classList.replace('dark-theme','light-theme');
        event.target.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ';
      }
    };

    // CORS proxy
    function proxy(url) {
      return 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
    }

    // State
    let mode='fetch', query='', page=1, total=1;
    const resultsEl = document.getElementById('results');
    const loadMoreBtn = document.getElementById('loadMore');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const modeSelect = document.getElementById('modeSelect');
    const mainContent = document.getElementById('mainContent');
    const detailContent = document.getElementById('detailContent');
    const backBtn = document.getElementById('backBtn');

    async function loadScripts() {
      resultsEl.innerHTML = page===1 ? '<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</p>' : resultsEl.innerHTML;
      try {
        const base = 'https://scriptblox.com/api/script/';
        const p = `&page=${page}`;
        let endpoint = '';
        if (mode==='search') endpoint = `search?q=${encodeURIComponent(query)}${p}`;
        else if (mode==='fetch') endpoint = `fetch?page=${page}`;
        else if (mode==='free') endpoint = `fetch?mode=free${p}`;
        else if (mode==='unverified') endpoint = `fetch?verified=0${p}`;
        else if (mode==='mostviewed') endpoint = `fetch?sortBy=views&order=desc${p}`;
        else endpoint = `fetch?filters=verified&legacy_filters=true${p}`;
        const res = await fetch(proxy(base+endpoint));
        const data = await res.json();
        const R = data.result||data;
        total = R.totalPages||1;
        if (page===1) resultsEl.innerHTML = '';
        if (!R.scripts || !R.scripts.length) {
          if (page===1) resultsEl.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</p>';
        } else {
          R.scripts.forEach(s => {
            const card = document.createElement('div');
            card.className = 'script-card';
            const date = new Date(s.createdAt).toLocaleDateString('ar-EG');
            const views = s.views||0;
            card.innerHTML = `
              <img src="${s.game?.imageUrl||s.image||'https://via.placeholder.com/240x140'}" alt="" 
                   onclick="showDetail('${s.slug}')">
              <div class="overlay-left">ğŸ‘ï¸ ${views}</div>
              <div class="overlay-right">ğŸ“… ${date}</div>
              <div class="script-info">
                <h3>${s.title}</h3>
              </div>`;
            resultsEl.appendChild(card);
          });
        }
        loadMoreBtn.style.display = page<total ? 'block' : 'none';
      } catch {
        resultsEl.innerHTML = '<p>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹</p>';
      }
    }

    async function showDetail(slug) {
      try {
        const res = await fetch(proxy(`https://scriptblox.com/api/script/${slug}`));
        const data = await res.json();
        const sc = data.script;
        mainContent.style.display = 'none';
        detailContent.style.display = 'block';
        document.getElementById('detailImage').src = sc.game.imageUrl;
        document.getElementById('detailTitle').textContent = sc.title;
        document.getElementById('detailGame').textContent = sc.game.name;
        document.getElementById('detailDate').textContent = new Date(sc.createdAt).toLocaleDateString('ar-EG');
        document.getElementById('description').textContent = sc.features || 'â€”';
        document.getElementById('codeBox').textContent = sc.script;
      } catch {
        alert('âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„');
      }
    }

    // Events
    backBtn.onclick = () => {
      detailContent.style.display = 'none';
      mainContent.style.display = 'block';
    };
    searchBtn.onclick = () => {
      const q = searchInput.value.trim();
      if (!q) return alert('ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø¨Ø­Ø«');
      mode='search'; query=q; page=1; resultsEl.innerHTML=''; loadScripts();
    };
    searchInput.addEventListener('keypress', e => {
      if (e.key==='Enter') searchBtn.click();
    });
    modeSelect.onchange = () => {
      mode = modeSelect.value; query=''; page=1; resultsEl.innerHTML=''; loadScripts();
    };
    loadMoreBtn.onclick = () => {
      if (page<total) { page++; loadScripts(); }
    };
    document.getElementById('codeCopyBtn').onclick = () => {
      const text = document.getElementById('codeBox').textContent;
      navigator.clipboard.writeText(text)
        .then(()=> alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯'))
        .catch(()=> alert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®'));
    };

    // Initialize
    window.addEventListener('load', loadScripts);
  </script>
</body>
</html>
