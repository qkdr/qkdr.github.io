<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø§ÙƒØ³Ø¨Ù„ÙˆÙŠØª Ø§Ù„Ø¹Ø±Ø¨</title>
  <style>
    :root {
      --bg-light: #ffffff;
      --text-light: #000000;
      --bg-dark: #121212;
      --text-dark: #ffffff;
      --card-bg-light: rgba(0,0,0,0.05);
      --card-bg-dark: rgba(255,255,255,0.1);
    }
    body {
      margin: 0; padding: 0;
      font-family: 'Tajawal', sans-serif;
      transition: background 0.3s, color 0.3s;
    }
    body.light-theme {
      background: var(--bg-light);
      color: var(--text-light);
    }
    body.dark-theme {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    .glass {
      background: var(--card-bg-light);
      border-radius: 12px;
      padding: 20px; margin: 20px auto;
      max-width: 900px;
      transition: background 0.3s;
    }
    body.dark-theme .glass {
      background: var(--card-bg-dark);
    }
    h1 { text-align: center; margin-bottom: 10px; }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 900px;
      margin: 20px auto 0;
      padding: 0 20px;
    }
    .toggle-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    body.light-theme .toggle-btn {
      background: #333; color: #fff;
    }
    body.dark-theme .toggle-btn {
      background: #eee; color: #000;
    }
    .controls {
      text-align: center; margin-bottom: 15px;
    }
    select, input[type="text"], .btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #aaa;
      margin: 0 5px 10px;
      font-size: 1em;
    }
    body.dark-theme select,
    body.dark-theme input[type="text"] {
      background: #222; color: #ddd; border-color: #555;
    }
    body.light-theme select,
    body.light-theme input[type="text"] {
      background: #fff; color: #000;
    }
    .btn {
      cursor: pointer;
      background: #007bff;
      color: #fff;
      border: none;
      transition: background 0.3s;
    }
    .btn:hover {
      background: #0056b3;
    }
    #searchLabel {
      margin-bottom: 10px;
      font-weight: bold;
    }
    #results {
      display: flex; flex-wrap: wrap; justify-content: center;
    }
    .script-card {
      width: 240px; margin: 10px;
      border-radius: 8px; overflow: hidden;
      transition: transform 0.2s;
      background: var(--card-bg-light);
    }
    body.dark-theme .script-card {
      background: var(--card-bg-dark);
    }
    .script-card:hover { transform: scale(1.03); }
    .script-card img {
      width: 100%; height: 140px; object-fit: cover;
    }
    .overlay-left, .overlay-right {
      position: absolute; top: 8px; padding: 4px 8px;
      background: rgba(0,0,0,0.5); color: #fff; border-radius: 4px;
      font-size: 0.8em;
    }
    .overlay-left { left: 8px; }
    .overlay-right { right: 8px; }
    .script-info { padding: 10px; text-align: center; position: relative; }
    .script-info h3 {
      margin: 5px 0; font-size: 1em;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    #loadMore { display: block; margin: 20px auto; }
    .modal {
      position: fixed; top:50%; left:50%;
      transform: translate(-50%,-50%) scale(0);
      width: 90%; max-width: 700px;
      background: var(--bg-light); color: var(--text-light);
      padding:20px; border-radius:8px; transition: transform 0.3s;
      z-index: 1000;
    }
    body.dark-theme .modal {
      background: var(--bg-dark); color: var(--text-dark);
    }
    .modal.show { transform: translate(-50%,-50%) scale(1); }
    .modal .close {
      position: absolute; top:8px; right:12px; cursor: pointer;
      font-size: 1.2em;
    }
    .modal .copy-btn {
      position: absolute; bottom:12px; right:12px;
      padding:6px 12px; border:none; cursor:pointer;
      background: #28a745; color:#fff; border-radius:4px;
    }
    .modal .copy-btn:hover { background: #1e7e34; }
    .modal h2 { margin-top:0; text-align:center; }
    .modal pre {
      max-height:60vh; overflow-y:auto;
      background: rgba(0,0,0,0.05); padding:10px; border-radius:4px;
    }
  </style>
</head>
<body class="light-theme">

  <div class="topbar">
    <h1>Ø§ÙƒØ³Ø¨Ù„ÙˆÙŠØª Ø§Ù„Ø¹Ø±Ø¨</h1>
    <button id="themeToggle" class="toggle-btn">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
  </div>

  <div class="glass">
    <div class="controls">
      <label id="searchLabel">Ø¨Ø­Ø« Ø¹Ù†: â€”</label><br>
      <input id="searchInput" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙƒØ±Ø¨Øªâ€¦">
      <button id="searchBtn" class="btn">Ø¨Ø­Ø«</button><br>
      <select id="modeSelect">
        <option value="fetch">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</option>
        <option value="free">Ù…Ø¬Ø§Ù†ÙŠØ©</option>
        <option value="unverified">ØºÙŠØ± Ù…Ø­Ù‚Ù‚Ø©</option>
        <option value="mostviewed">Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø´Ø§Ù‡Ø¯Ø©</option>
        <option value="verified">Ù…Ø­Ù‚Ù‚Ø©</option>
      </select>
    </div>
    <div id="results"></div>
    <button id="loadMore" class="btn" style="display:none;">Ø§Ù„Ù…Ø²ÙŠØ¯</button>
  </div>

  <div id="scriptModal" class="modal">
    <span class="close" onclick="closeModal()">âœ–</span>
    <h2 id="scriptTitle"></h2>
    <pre id="scriptContent"></pre>
    <button class="copy-btn" id="copyBtn">Ù†Ø³Ø®</button>
  </div>

  <script>
    let mode = 'fetch', query = '', page = 1, total = 1;
    const results = document.getElementById('results');
    const loadMore = document.getElementById('loadMore');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const modeSelect = document.getElementById('modeSelect');
    const searchLabel = document.getElementById('searchLabel');
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;

    const modal = document.getElementById('scriptModal');
    const tEl = document.getElementById('scriptTitle');
    const cEl = document.getElementById('scriptContent');
    const copyBtn = document.getElementById('copyBtn');

    function proxy(url) {
      return 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
    }
    function apiURL() {
      const base = 'https://scriptblox.com/api/script/';
      const p = `&page=${page}`;
      if (mode === 'search')
        return proxy(base + `search?q=${encodeURIComponent(query)}${p}`);
      return proxy(base + 
        (mode === 'fetch' ? `fetch?page=${page}` :
        mode === 'free' ? `fetch?mode=free${p}` :
        mode === 'unverified' ? `fetch?verified=0${p}` :
        mode === 'mostviewed' ? `fetch?sortBy=views&order=desc${p}` :
        `fetch?filters=verified&legacy_filters=true${p}`)
      );
    }

    async function loadScripts() {
      try {
        if (page === 1) results.innerHTML = `<p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</p>`;
        const res = await fetch(apiURL());
        const data = await res.json();
        const R = data.result || data;
        total = R.totalPages || 1;
        if (page === 1) results.innerHTML = '';
        if (!R.scripts || !R.scripts.length) {
          if (page === 1) results.innerHTML = `<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬.</p>`;
        } else {
          R.scripts.forEach(s => {
            const card = document.createElement('div');
            card.className = 'script-card';
            const date = new Date(s.createdAt).toLocaleDateString('ar-EG');
            const views = s.views || 0;
            card.innerHTML = `
              <div style="position:relative;">
                <img src="${s.game?.imageUrl||s.image||'https://via.placeholder.com/240x140'}" alt="">
                <div class="overlay-left">ğŸ‘ï¸ ${views}</div>
                <div class="overlay-right">ğŸ“… ${date}</div>
              </div>
              <div class="script-info">
                <h3>${s.title}</h3>
                <button class="btn" onclick="showScript('${s.slug}','${s.title}')">Ø¹Ø±Ø¶</button>
              </div>`;
            results.appendChild(card);
          });
        }
        loadMore.style.display = page < total ? 'block' : 'none';
      } catch {
        results.innerHTML = `<p>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹</p>`;
      }
    }

    async function showScript(slug, title) {
      try {
        const res = await fetch(proxy(`https://scriptblox.com/api/script/${slug}`));
        const d = await res.json();
        const sc = d.script;
        if (sc && sc.script) {
          tEl.textContent = title;
          cEl.textContent = sc.script;
          modal.classList.add('show');
        } else alert('âš ï¸ ØºÙŠØ± Ù…ØªØ§Ø­');
      } catch {
        alert('âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„');
      }
    }
    function closeModal() { modal.classList.remove('show'); }

    function doSearch() {
      const q = searchInput.value.trim();
      if (!q) return alert('ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø¨Ø­Ø«');
      query = q; mode = 'search'; page = 1; results.innerHTML = '';
      searchLabel.textContent = `Ø¨Ø­Ø« Ø¹Ù†: ${q}`;
      loadScripts();
    }

    searchBtn.addEventListener('click', doSearch);
    searchInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') doSearch();
    });

    modeSelect.addEventListener('change', () => {
      mode = modeSelect.value; query = ''; page = 1; results.innerHTML = '';
      searchLabel.textContent = 'Ø¨Ø­Ø« Ø¹Ù†: â€”';
      loadScripts();
    });

    loadMore.addEventListener('click', () => {
      if (page < total) { page++; loadScripts(); }
    });

    themeToggle.addEventListener('click', () => {
      if (body.classList.contains('light-theme')) {
        body.classList.replace('light-theme','dark-theme');
        themeToggle.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­';
      } else {
        body.classList.replace('dark-theme','light-theme');
        themeToggle.textContent = 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ';
      }
    });

    window.addEventListener('load', () => {
      loadScripts();
    });
  </script>
</body>
</html>
